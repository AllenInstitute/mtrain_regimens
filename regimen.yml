_passive_training_cluster_script: &passive_training_cluster_script http://stash.corp.alleninstitute.org/users/jeromel/repos/illusionopenscope/raw/illusion_stimulus_pilot.py?at=73b9bdcbed6c467dbbdca9bcd0e9ae18cf2ccc03
_passive_training_cluster_script_md5: &passive_training_cluster_script_md5 bf348e6e0b55818f8fc4bf7b61999adb

_passive_training_ephys_script: &passive_training_ephys_script http://stash.corp.alleninstitute.org/users/jeromel/repos/illusionopenscope/raw/illusion_stimulus_habit.py?at=73b9bdcbed6c467dbbdca9bcd0e9ae18cf2ccc03
_passive_training_ephys_script_md5: &passive_training_ephys_script_md5 7b7b5945b9fc51a3185628826be97ff8

_passive_prod_ephys_script: &passive_prod_ephys_script http://stash.corp.alleninstitute.org/users/jeromel/repos/illusionopenscope/raw/illusion_stimulus_fullpipe.py?at=73b9bdcbed6c467dbbdca9bcd0e9ae18cf2ccc03
_passive_prod_ephys_script_md5: &passive_prod_ephys_script_md5 659e45e612879b5b0ad01fb2f90983e3

_optotagging_script: &optotagging_script http://stash.corp.alleninstitute.org/users/jeromel/repos/illusionopenscope/raw/opto-tagging-only.py?at=b4483d5e684a62a2a02ccae5b1259b8b91df6d9d
_optotagging_script_md5: &optotagging_script_md5 1decc7c7dcf5f81ef976912ca58560e9

_visual_test_optotagging_script: &visual_test_optotagging_script http://stash.corp.alleninstitute.org/users/jeromel/repos/illusionopenscope/raw/illusion_stimulus_test_with_optotagging.py?at=b4483d5e684a62a2a02ccae5b1259b8b91df6d9d
_visual_test_optotagging_script_md5: &visual_test_optotagging_script_md5 1dc35094c4aeecb5b102a4a86663951f

### mtrain definitions
name: Openscope_Illusion_v12

transitions:
  - trigger: progress
    source: PASSIVE_CLUSTER_HAB_10MIN_DAY6
    dest: PASSIVE_CLUSTER_HAB_20MIN_DAY7
    conditions: one_complete

  - trigger: progress
    source: PASSIVE_CLUSTER_HAB_20MIN_DAY7
    dest: PASSIVE_CLUSTER_HAB_30MIN_DAY8
    conditions: one_complete

  - trigger: progress
    source: PASSIVE_CLUSTER_HAB_30MIN_DAY8
    dest: PASSIVE_CLUSTER_HAB_40MIN_DAY9
    conditions: one_complete

  - trigger: progress
    source: PASSIVE_CLUSTER_HAB_40MIN_DAY9
    dest: PASSIVE_CLUSTER_HAB_50MIN_DAY10
    conditions: one_complete
  
  - trigger: manual
    source: PASSIVE_CLUSTER_HAB_50MIN_DAY10
    dest: PASSIVE_EPHYS_HAB_60MIN_DAY1_2

  - trigger: manual
    source: PASSIVE_EPHYS_HAB_60MIN_DAY1_2
    dest: PASSIVE_EPHYS_HAB_90MIN_DAY3_4

  - trigger: manual
    source: PASSIVE_EPHYS_HAB_90MIN_DAY3_4
    dest: PASSIVE_EPHYS_HAB_120MIN_DAY5

  - trigger: manual
    source: PASSIVE_EPHYS_HAB_120MIN_DAY5
    dest: PASSIVE_EPHYS_PROD_120MIN_DAY1

  - trigger: manual
    source: PASSIVE_EPHYS_PROD_120MIN_DAY1
    dest: OPTOTAGGING_ONLY

  - trigger: manual
    source: OPTOTAGGING_ONLY
    dest: VISUALTEST_OPTOTAGGING_ONLY

stages:
  PASSIVE_CLUSTER_HAB_10MIN_DAY6:
    script: *passive_training_cluster_script
    script_md5: *passive_training_cluster_script_md5
    parameters:
      stage: PASSIVE_CLUSTER_HAB_10MIN_DAY6
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      Nrep: 2

  PASSIVE_CLUSTER_HAB_20MIN_DAY7:
    script: *passive_training_cluster_script
    script_md5: *passive_training_cluster_script_md5
    parameters:
      stage: PASSIVE_CLUSTER_HAB_20MIN_DAY7
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      Nrep: 5

  PASSIVE_CLUSTER_HAB_30MIN_DAY8:
    script: *passive_training_cluster_script
    script_md5: *passive_training_cluster_script_md5
    parameters:
      stage: PASSIVE_CLUSTER_HAB_30MIN_DAY8
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      Nrep: 8

  PASSIVE_CLUSTER_HAB_40MIN_DAY9:
    script: *passive_training_cluster_script
    script_md5: *passive_training_cluster_script_md5
    
    parameters:
      stage: PASSIVE_CLUSTER_HAB_40MIN_DAY9
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      Nrep: 10

  PASSIVE_CLUSTER_HAB_50MIN_DAY10:
    script: *passive_training_cluster_script
    script_md5: *passive_training_cluster_script_md5

    parameters:
      stage: PASSIVE_CLUSTER_HAB_50MIN_DAY10
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      Nrep: 14

  PASSIVE_EPHYS_HAB_60MIN_DAY1_2:
    script: *passive_training_ephys_script
    script_md5: *passive_training_ephys_script_md5

    parameters:
      stage: PASSIVE_EPHYS_HAB_60MIN_DAY1_2
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      DURFAC: 2

  PASSIVE_EPHYS_HAB_90MIN_DAY3_4:
    script: *passive_training_ephys_script
    script_md5: *passive_training_ephys_script_md5

    parameters:
      stage: PASSIVE_EPHYS_HAB_90MIN_DAY3_4
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      DURFAC: 3
      
  PASSIVE_EPHYS_HAB_120MIN_DAY5:
    script: *passive_prod_ephys_script
    script_md5: *passive_prod_ephys_script_md5

    parameters:
      stage: PASSIVE_EPHYS_HAB_120MIN_DAY5
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # no optotagging
      disable_opto: True
      
  PASSIVE_EPHYS_PROD_120MIN_DAY1:
    script: *passive_prod_ephys_script
    script_md5: *passive_prod_ephys_script_md5

    parameters:
      stage: PASSIVE_EPHYS_PROD_120MIN_DAY1
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # optotagging      
      disable_opto: False

      opto_params: 
        operation_mode: "experiment"

  OPTOTAGGING_ONLY:
    script: *optotagging_script
    script_md5: *optotagging_script_md5
    parameters:
      stage: OPTOTAGGING_ONLY

      # optotagging      
      disable_opto: False

      opto_params: 
        operation_mode: "experiment"

  VISUALTEST_OPTOTAGGING_ONLY:
    script: *visual_test_optotagging_script
    script_md5: *visual_test_optotagging_script_md5
    parameters:
      stage: VISUALTEST_OPTOTAGGING_ONLY
      shared_repository_location: //allen/programs/mindscope/workgroups/openscope/2022-Illusion/Scripts/Production/illusionopenscope
      monitor_name: "Gamma1.Luminance50"

      # control number of repetition to make longer script
      Nrep: 1

      # optotagging      
      disable_opto: False

      opto_params: 
        operation_mode: "experiment"